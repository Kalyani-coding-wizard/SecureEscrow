{% extends "base.html" %}

{% block title %}Setup MFA - SecureEscrow{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header text-center py-4">
                <h3 class="mb-0">
                    <i class="bi bi-shield-lock text-primary me-2"></i>
                    Enable Two-Factor Authentication
                </h3>
                <p class="text-muted mb-0 mt-2">Add an extra layer of security to your account</p>
            </div>
            <div class="card-body p-4">
                <!-- Step 1: Scan QR Code -->
                <div class="mb-4">
                    <h5 class="mb-3">
                        <span class="badge bg-primary me-2">1</span>
                        Scan QR Code
                    </h5>
                    <p class="text-muted small">
                        Scan this QR code with your authenticator app (Google Authenticator, Authy, Microsoft
                        Authenticator, etc.)
                    </p>
                    <div class="text-center mb-3">
                        <img src="data:image/png;base64,{{ qr_code }}" alt="MFA QR Code" class="border rounded"
                            style="max-width: 200px;">
                    </div>
                </div>

                <!-- Manual Entry -->
                <div class="mb-4">
                    <h5 class="mb-3">
                        <span class="badge bg-secondary me-2">OR</span>
                        Enter Code Manually
                    </h5>
                    <div class="alert alert-dark">
                        <code class="user-select-all fs-5">{{ secret }}</code>
                    </div>
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        Type: TOTP, Algorithm: SHA-1, Digits: 6, Period: 30s
                    </small>
                </div>

                <!-- Step 2: Verify -->
                <div class="mb-4">
                    <h5 class="mb-3">
                        <span class="badge bg-primary me-2">2</span>
                        Enter Verification Code
                    </h5>
                    <form method="POST">
                        <div class="mb-3">
                            <input type="text" class="form-control form-control-lg text-center" name="code"
                                placeholder="000000" maxlength="6" pattern="[0-9]{6}" required autofocus
                                style="letter-spacing: 0.5em; font-size: 1.5rem;">
                            <div class="form-text">Enter the 6-digit code from your authenticator app</div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-shield-check me-2"></i>Verify & Enable MFA
                        </button>
                    </form>
                </div>

                <!-- MFA Info -->
                <div class="alert alert-info mb-0">
                    <h6><i class="bi bi-info-circle me-2"></i>About TOTP (Time-based OTP)</h6>
                    <ul class="mb-0 small">
                        <li><strong>Algorithm:</strong> HMAC-SHA1 (RFC 6238)</li>
                        <li><strong>Secret Length:</strong> 160 bits (Base32 encoded)</li>
                        <li><strong>Code Length:</strong> 6 digits</li>
                        <li><strong>Time Step:</strong> 30 seconds</li>
                    </ul>
                </div>
            </div>
            <div class="card-footer text-center py-3">
                <a href="{{ url_for('auth.profile') }}" class="text-muted">Cancel and return to profile</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}